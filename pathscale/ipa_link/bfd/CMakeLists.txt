ADD_DEFINITIONS(-DHAVE_CONFIG_H=1)

INCLUDE_DIRECTORIES(BEFORE
  ${BFD_SOURCE_DIR}/include
  ${BFD_SOURCE_DIR}/../include
  ${BFD_SOURCE_DIR}
  ${CMAKE_CURRENT_BINARY_DIR}
)

SET(BFD_SRCS
archive.c
archures.c
bfd.c
bfdio.c
bfdwin.c
cache.c
coffgen.c
corefile.c
format.c
init.c
libbfd.c
opncls.c
reloc.c
section.c
syms.c
hash.c
linker.c
srec.c
binary.c
tekhex.c
ihex.c
stabs.c
stab-syms.c
merge.c
dwarf2.c
simple.c
archive64.c
elf64-x86-64.c
elf64.c
elf.c
elflink.c
elf-strtab.c
elf-eh-frame.c
dwarf1.c
ipa_ld.c
ipa_cmdline.c
elf32-i386.c
elf-vxworks.c
elf32.c
i386linux.c
aout32.c
efi-app-ia32.c
cofflink.c
elf64-gen.c
elf32-gen.c
cpu-i386.c
targets.c
peigen.c
  )
# We should generate bfd-h from the template below instead of hard coded
# ipa_link/bfd/bfd-in.h

# peigen.c should be generated like this, but we're just generating and
# commmiting to the source tree
# peigen.c : peXXigen.c
#        rm -f peigen.c
#        sed -e s/XX/pe/g < $(srcdir)/peXXigen.c > peigen.new
#        mv -f peigen.new peigen.c

# Generate ldemul-list.h
#(echo "/* This file is automatically generated.  DO NOT EDIT! */";\
#  for f in `echo " " eelf_x86_64.o eelf_i386.o ei386linux.o "" \
#   | sed -e 's/ e/ ld/g' -e 's/ ld/ /g' -e 's/[.]o//g'`; do \
#      echo "extern ld_emulation_xfer_type ld_${f}_emulation;"; \
#  done;\
#  echo "";\
#  echo "#define EMULATION_LIST \\";\
#  for f in `echo " " eelf_x86_64.o eelf_i386.o ei386linux.o "" \
#   | sed -e 's/ e/ ld/g' -e 's/ ld/ /g' -e 's/[.]o//g'`; do \
#      echo "  &ld_${f}_emulation, \\"; \
#  done;\
#  echo "  0") >ldemul-tmp.h
#mv ldemul-tmp.h ldemul-list.h


set_property(SOURCE archures.c targets.c PROPERTY COMPILE_DEFINITIONS DEFAULT_VECTOR=bfd_elf64_x86_64_vec;SELECT_VECS=&bfd_elf64_x86_64_vec,&bfd_elf32_i386_vec,&i386linux_vec,&bfd_efi_app_ia32_vec,&bfd_elf64_little_generic_vec,&bfd_elf64_big_generic_vec,&bfd_elf32_little_generic_vec,&bfd_elf32_big_generic_vec;SELECT_ARCHITECTURES=&bfd_i386_arch;HAVE_bfd_elf64_x86_64_vec;HAVE_bfd_elf32_i386_vec;HAVE_i386linux_vec;HAVE_bfd_efi_app_ia32_vec;HAVE_bfd_elf64_little_generic_vec;HAVE_bfd_elf64_big_generic_vec;HAVE_bfd_elf32_little_generic_vec;HAVE_bfd_elf32_big_generic_vec)
 
ADD_LIBRARY(bfd STATIC ${BFD_SRCS})
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/config.h.in ${CMAKE_CURRENT_BINARY_DIR}/config.h)
